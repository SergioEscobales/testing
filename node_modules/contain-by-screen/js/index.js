"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = containByScreen;

var _flatten = _interopRequireDefault(require("lodash/flatten"));

var _uniq = _interopRequireDefault(require("lodash/uniq"));

function containByScreen(element, anchorPoint, options) {
  if (process.env.NODE_ENV !== 'production' && window.getComputedStyle) {
    var style = window.getComputedStyle(element);

    if (style.position !== 'fixed') {
      // eslint-disable-next-line no-console
      console.error('containByScreen only works on fixed position elements', element);
    }
  }

  var elRect = getBoundingClientRect(element);
  var anchorRect = getBoundingClientRect(anchorPoint);
  var buffers = {
    all: options.buffer || 0,
    top: options.topBuffer || 0,
    bottom: options.bottomBuffer || 0,
    left: options.leftBuffer || 0,
    right: options.rightBuffer || 0
  };
  var optionPositions = Array.isArray(options.position) ? options.position : [options.position].filter(Boolean);
  var optionHAligns = Array.isArray(options.hAlign) ? options.hAlign : [options.hAlign].filter(Boolean);
  var optionVAligns = Array.isArray(options.vAlign) ? options.vAlign : [options.vAlign].filter(Boolean);
  var positions = optionPositions.length > 0 && options.forcePosition ? optionPositions : (0, _uniq.default)(optionPositions.concat(['top', 'bottom', 'left', 'right']));
  var hAligns = optionHAligns.length > 0 && options.forceHAlign ? optionHAligns : (0, _uniq.default)(optionHAligns.concat(['center', 'left', 'right']));
  var vAligns = optionVAligns.length > 0 && options.forceVAlign ? optionVAligns : (0, _uniq.default)(optionVAligns.concat(['center', 'top', 'bottom']));
  var allPossibleChoices = (0, _flatten.default)(positions.map(function (position) {
    return position === 'cover' ? (0, _flatten.default)(hAligns.map(function (hAlign) {
      return vAligns.map(function (vAlign) {
        return {
          position: position,
          hAlign: hAlign,
          vAlign: vAlign
        };
      });
    })) : position === 'top' || position === 'bottom' ? hAligns.map(function (hAlign) {
      return {
        position: position,
        hAlign: hAlign,
        vAlign: 'center'
      };
    }) : vAligns.map(function (vAlign) {
      return {
        position: position,
        hAlign: 'center',
        vAlign: vAlign
      };
    });
  }));
  var choiceAndCoord = null;

  for (var i = 0; i < allPossibleChoices.length; i++) {
    var choice = allPossibleChoices[i];
    var coord = positionAndAlign(elRect, anchorRect, choice, buffers);
    var top = coord.top,
        left = coord.left;

    if (top - buffers.all - buffers.top >= 0 && left - buffers.all - buffers.left >= 0 && top + elRect.height + buffers.all + buffers.bottom <= window.innerHeight && left + elRect.width + buffers.all + buffers.right <= window.innerWidth) {
      choiceAndCoord = {
        choice: choice,
        coord: coord
      };
      break;
    }
  } // Fallback if we failed to find a position that fit on the screen.


  if (!choiceAndCoord) {
    var _choice = {
      position: optionPositions[0] || 'top',
      hAlign: optionHAligns[0] || 'center',
      vAlign: optionVAligns[0] || 'center'
    };
    choiceAndCoord = {
      choice: _choice,
      coord: positionAndAlign(elRect, anchorRect, _choice, buffers)
    };
  }

  element.style.top = "".concat(choiceAndCoord.coord.top, "px");
  element.style.left = "".concat(choiceAndCoord.coord.left, "px");
  return choiceAndCoord.choice;
}

function getBoundingClientRect(el) {
  var rect = el.getBoundingClientRect();

  if (!('width' in rect)) {
    // IE <9 support
    rect = Object.assign({
      width: rect.right - rect.left,
      height: rect.bottom - rect.top
    }, rect);
  }

  return rect;
}

function positionAndAlign(elRect, anchorRect, _ref, buffers) {
  var position = _ref.position,
      hAlign = _ref.hAlign,
      vAlign = _ref.vAlign;
  var top = 0,
      left = 0;

  if (position === 'cover') {
    switch (hAlign) {
      case 'center':
        left = Math.round((anchorRect.left + anchorRect.right - elRect.width) / 2);
        break;

      case 'left':
        left = Math.floor(anchorRect.left);
        break;

      case 'right':
        left = Math.ceil(anchorRect.right - elRect.width);
        break;

      default:
        throw new Error('Should not happen');
    }

    switch (vAlign) {
      case 'center':
        top = Math.round((anchorRect.top + anchorRect.bottom - elRect.height) / 2);
        break;

      case 'top':
        top = Math.floor(anchorRect.top);
        break;

      case 'bottom':
        top = Math.ceil(anchorRect.bottom - elRect.height);
        break;

      default:
        throw new Error('Should not happen');
    }
  } else if (position === 'top' || position === 'bottom') {
    switch (position) {
      case 'top':
        top = Math.floor(anchorRect.top - elRect.height - buffers.all - buffers.bottom);
        break;

      case 'bottom':
        top = Math.ceil(anchorRect.bottom + buffers.all + buffers.top);
        break;

      default:
        throw new Error('Should not happen');
    }

    switch (hAlign) {
      case 'center':
        left = Math.round((anchorRect.left + anchorRect.right - elRect.width) / 2);
        break;

      case 'left':
        left = Math.round(anchorRect.left);
        break;

      case 'right':
        left = Math.round(anchorRect.right - elRect.width);
        break;

      default:
        throw new Error('Should not happen');
    }
  } else {
    switch (position) {
      case 'left':
        left = Math.floor(anchorRect.left - elRect.width - buffers.all - buffers.right);
        break;

      case 'right':
        left = Math.ceil(anchorRect.right + buffers.all + buffers.left);
        break;

      default:
        throw new Error('Should not happen');
    }

    switch (vAlign) {
      case 'center':
        top = Math.round((anchorRect.top + anchorRect.bottom - elRect.height) / 2);
        break;

      case 'top':
        top = Math.round(anchorRect.top);
        break;

      case 'bottom':
        top = Math.round(anchorRect.bottom - elRect.height);
        break;

      default:
        throw new Error('Should not happen');
    }
  }

  return {
    top: top,
    left: left
  };
}

module.exports = exports.default;
module.exports.default = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJjb250YWluQnlTY3JlZW4iLCJlbGVtZW50IiwiYW5jaG9yUG9pbnQiLCJvcHRpb25zIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwid2luZG93IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsInN0eWxlIiwicG9zaXRpb24iLCJjb25zb2xlIiwiZXJyb3IiLCJlbFJlY3QiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJhbmNob3JSZWN0IiwiYnVmZmVycyIsImFsbCIsImJ1ZmZlciIsInRvcCIsInRvcEJ1ZmZlciIsImJvdHRvbSIsImJvdHRvbUJ1ZmZlciIsImxlZnQiLCJsZWZ0QnVmZmVyIiwicmlnaHQiLCJyaWdodEJ1ZmZlciIsIm9wdGlvblBvc2l0aW9ucyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIkJvb2xlYW4iLCJvcHRpb25IQWxpZ25zIiwiaEFsaWduIiwib3B0aW9uVkFsaWducyIsInZBbGlnbiIsInBvc2l0aW9ucyIsImxlbmd0aCIsImZvcmNlUG9zaXRpb24iLCJjb25jYXQiLCJoQWxpZ25zIiwiZm9yY2VIQWxpZ24iLCJ2QWxpZ25zIiwiZm9yY2VWQWxpZ24iLCJhbGxQb3NzaWJsZUNob2ljZXMiLCJtYXAiLCJjaG9pY2VBbmRDb29yZCIsImkiLCJjaG9pY2UiLCJjb29yZCIsInBvc2l0aW9uQW5kQWxpZ24iLCJoZWlnaHQiLCJpbm5lckhlaWdodCIsIndpZHRoIiwiaW5uZXJXaWR0aCIsImVsIiwicmVjdCIsIk9iamVjdCIsImFzc2lnbiIsIk1hdGgiLCJyb3VuZCIsImZsb29yIiwiY2VpbCIsIkVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFzQ2UsU0FBU0EsZUFBVCxDQUF5QkMsT0FBekIsRUFBK0NDLFdBQS9DLEVBQXlFQyxPQUF6RSxFQUNSO0FBQ0wsTUFBSUMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFFBQVosS0FBeUIsWUFBekIsSUFBeUNDLE1B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QUl3QyxLQUFKLENBQVUsbUJBQVYsQ0FBTjtBQVBUOztBQVNBLFlBQVE1QixNQUFSO0FBQ0EsV0FBSyxRQUFMO0FBQ0VoQixRQUFBQSxHQUFHLEdBQUd3QyxJQUFJLENBQUNDLEtBQUwsQ0FBVyxDQUFDN0MsVUFBVSxDQUFDSSxHQUFYLEdBQWlCSixVQUFVLENBQUNNLE1BQTVCLEdBQXFDUixNQUFNLENBQUNzQyxNQUE3QyxJQUFxRCxDQUFoRSxDQUFOO0FBQ0E7O0FBQ0YsV0FBSyxLQUFMO0FBQ0VoQyxRQUFBQSxHQUFHLEdBQUd3QyxJQUFJLENBQUNDLEtBQUwsQ0FBVzdDLFVBQVUsQ0FBQ0ksR0FBdEIsQ0FBTjtBQUNBOztBQUNGLFdBQUssUUFBTDtBQUNFQSxRQUFBQSxHQUFHLEdBQUd3QyxJQUFJLENBQUNDLEtBQUwsQ0FBVzdDLFVBQVUsQ0FBQ00sTUFBWCxHQUFvQlIsTUFBTSxDQUFDc0MsTUFBdEMsQ0FBTjtBQUNBOztBQUNGO0FBQVMsY0FBTSxJQUFJWSxLQUFKLENBQVUsbUJBQVYsQ0FBTjtBQVZUO0FBWUQ7O0FBQ0QsU0FBTztBQUFDNUMsSUFBQUEsR0FBRyxFQUFIQSxHQUFEO0FBQU1JLElBQUFBLElBQUksRUFBSkE7QUFBTixHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBAZmxvdyAqL1xuXG5pbXBvcnQgZmxhdHRlbiBmcm9tICdsb2Rhc2gvZmxhdHRlbic7XG5pbXBvcnQgdW5pcSBmcm9tICdsb2Rhc2gvdW5pcSc7XG5cbnR5cGUgUG9zaXRpb25PcHRpb24gPSAndG9wJ3wnYm90dG9tJ3wnbGVmdCd8J3JpZ2h0J3wnY292ZXInO1xudHlwZSBIQWxpZ25PcHRpb24gPSAnY2VudGVyJ3wnbGVmdCd8J3JpZ2h0JztcbnR5cGUgVkFsaWduT3B0aW9uID0gJ2NlbnRlcid8J3RvcCd8J2JvdHRvbSc7XG5cbmV4cG9ydCB0eXBlIFBvc2l0aW9uID0gUG9zaXRpb25PcHRpb24gfCBQb3NpdGlvbk9wdGlvbltdO1xuZXhwb3J0IHR5cGUgSEFsaWduID0gSEFsaWduT3B0aW9uIHwgSEFsaWduT3B0aW9uW107XG5leHBvcnQgdHlwZSBWQWxpZ24gPSBWQWxpZ25PcHRpb24gfCBWQWxpZ25PcHRpb25bXTtcbmV4cG9ydCB0eXBlIENob2ljZSA9IHtcbiAgcG9zaXRpb246IFBvc2l0aW9uT3B0aW9uO1xuICBoQWxpZ246IEhBbGlnbk9wdGlvbjtcbiAgdkFsaWduOiBWQWxpZ25PcHRpb247XG59O1xuXG5leHBvcnQgdHlwZSBPcHRpb25zID0ge1xuICBwb3NpdGlvbj86ID9Qb3NpdGlvbjtcbiAgZm9yY2VQb3NpdGlvbj86ID9ib29sZWFuO1xuICBoQWxpZ24/OiA/SEFsaWduO1xuICBmb3JjZUhBbGlnbj86ID9ib29sZWFuO1xuICB2QWxpZ24/OiA/VkFsaWduO1xuICBmb3JjZVZBbGlnbj86ID9ib29sZWFuO1xuICBidWZmZXI/OiA/bnVtYmVyO1xuICB0b3BCdWZmZXI/OiA/bnVtYmVyO1xuICBib3R0b21CdWZmZXI/OiA/bnVtYmVyO1xuICBsZWZ0QnVmZmVyPzogP251bWJlcjtcbiAgcmlnaHRCdWZmZXI/OiA/bnVtYmVyO1xufTtcblxudHlwZSBSZWN0ID0geyAvLyBTaW1pbGFyIHRvIENsaWVudFJlY3QsIGJ1dCBub3QgYSBjbGFzc1xuICB0b3A6IG51bWJlcjtcbiAgYm90dG9tOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICBsZWZ0OiBudW1iZXI7XG4gIHJpZ2h0OiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjb250YWluQnlTY3JlZW4oZWxlbWVudDogSFRNTEVsZW1lbnQsIGFuY2hvclBvaW50OiBIVE1MRWxlbWVudCwgb3B0aW9uczogT3B0aW9ucyk6XG5DaG9pY2Uge1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkge1xuICAgIGNvbnN0IHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCk7XG4gICAgaWYgKHN0eWxlLnBvc2l0aW9uICE9PSAnZml4ZWQnKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgICAgY29uc29sZS5lcnJvcignY29udGFpbkJ5U2NyZWVuIG9ubHkgd29ya3Mgb24gZml4ZWQgcG9zaXRpb24gZWxlbWVudHMnLCBlbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBlbFJlY3Q6IFJlY3QgPSBnZXRCb3VuZGluZ0NsaWVudFJlY3QoZWxlbWVudCk7XG4gIGNvbnN0IGFuY2hvclJlY3Q6IFJlY3QgPSBnZXRCb3VuZGluZ0NsaWVudFJlY3QoYW5jaG9yUG9pbnQpO1xuXG4gIGNvbnN0IGJ1ZmZlcnMgPSB7XG4gICAgYWxsOiBvcHRpb25zLmJ1ZmZlciB8fCAwLFxuICAgIHRvcDogb3B0aW9ucy50b3BCdWZmZXIgfHwgMCxcbiAgICBib3R0b206IG9wdGlvbnMuYm90dG9tQnVmZmVyIHx8IDAsXG4gICAgbGVmdDogb3B0aW9ucy5sZWZ0QnVmZmVyIHx8IDAsXG4gICAgcmlnaHQ6IG9wdGlvbnMucmlnaHRCdWZmZXIgfHwgMFxuICB9O1xuXG4gIGNvbnN0IG9wdGlvblBvc2l0aW9ucyA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5wb3NpdGlvbikgPyBvcHRpb25zLnBvc2l0aW9uIDogW29wdGlvbnMucG9zaXRpb25dLmZpbHRlcihCb29sZWFuKTtcbiAgY29uc3Qgb3B0aW9uSEFsaWducyA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy5oQWxpZ24pID8gb3B0aW9ucy5oQWxpZ24gOiBbb3B0aW9ucy5oQWxpZ25dLmZpbHRlcihCb29sZWFuKTtcbiAgY29uc3Qgb3B0aW9uVkFsaWducyA9IEFycmF5LmlzQXJyYXkob3B0aW9ucy52QWxpZ24pID8gb3B0aW9ucy52QWxpZ24gOiBbb3B0aW9ucy52QWxpZ25dLmZpbHRlcihCb29sZWFuKTtcblxuICBjb25zdCBwb3NpdGlvbnM6IFBvc2l0aW9uT3B0aW9uW10gPSBvcHRpb25Qb3NpdGlvbnMubGVuZ3RoID4gMCAmJiBvcHRpb25zLmZvcmNlUG9zaXRpb24gP1xuICAgIG9wdGlvblBvc2l0aW9ucyA6XG4gICAgdW5pcShvcHRpb25Qb3NpdGlvbnMuY29uY2F0KFsndG9wJywnYm90dG9tJywnbGVmdCcsJ3JpZ2h0J10pKTtcbiAgY29uc3QgaEFsaWduczogSEFsaWduT3B0aW9uW10gPSBvcHRpb25IQWxpZ25zLmxlbmd0aCA+IDAgJiYgb3B0aW9ucy5mb3JjZUhBbGlnbiA/XG4gICAgb3B0aW9uSEFsaWducyA6XG4gICAgdW5pcShvcHRpb25IQWxpZ25zLmNvbmNhdChbJ2NlbnRlcicsJ2xlZnQnLCdyaWdodCddKSk7XG4gIGNvbnN0IHZBbGlnbnM6IFZBbGlnbk9wdGlvbltdID0gb3B0aW9uVkFsaWducy5sZW5ndGggPiAwICYmIG9wdGlvbnMuZm9yY2VWQWxpZ24gP1xuICAgIG9wdGlvblZBbGlnbnMgOlxuICAgIHVuaXEob3B0aW9uVkFsaWducy5jb25jYXQoWydjZW50ZXInLCd0b3AnLCdib3R0b20nXSkpO1xuXG4gIGNvbnN0IGFsbFBvc3NpYmxlQ2hvaWNlcyA9IGZsYXR0ZW4ocG9zaXRpb25zLm1hcChwb3NpdGlvbiA9PlxuICAgIChwb3NpdGlvbiA9PT0gJ2NvdmVyJykgP1xuICAgICAgZmxhdHRlbihoQWxpZ25zLm1hcChoQWxpZ24gPT4gdkFsaWducy5tYXAodkFsaWduID0+ICh7cG9zaXRpb24sIGhBbGlnbiwgdkFsaWdufSkpKSkgOlxuICAgICAgKHBvc2l0aW9uID09PSAndG9wJyB8fCBwb3NpdGlvbiA9PT0gJ2JvdHRvbScpID9cbiAgICAgICAgaEFsaWducy5tYXAoaEFsaWduID0+ICh7cG9zaXRpb24sIGhBbGlnbiwgdkFsaWduOiAnY2VudGVyJ30pKSA6XG4gICAgICAgIHZBbGlnbnMubWFwKHZBbGlnbiA9PiAoe3Bvc2l0aW9uLCBoQWxpZ246ICdjZW50ZXInLCB2QWxpZ259KSlcbiAgKSk7XG5cbiAgbGV0IGNob2ljZUFuZENvb3JkID0gbnVsbDtcbiAgZm9yIChsZXQgaT0wOyBpIDwgYWxsUG9zc2libGVDaG9pY2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgY29uc3QgY2hvaWNlID0gYWxsUG9zc2libGVDaG9pY2VzW2ldO1xuICAgIGNvbnN0IGNvb3JkID0gcG9zaXRpb25BbmRBbGlnbihlbFJlY3QsIGFuY2hvclJlY3QsIGNob2ljZSwgYnVmZmVycyk7XG4gICAgY29uc3Qge3RvcCwgbGVmdH0gPSBjb29yZDtcbiAgICBpZiAoXG4gICAgICB0b3AtYnVmZmVycy5hbGwtYnVmZmVycy50b3AgPj0gMCAmJlxuICAgICAgbGVmdC1idWZmZXJzLmFsbC1idWZmZXJzLmxlZnQgPj0gMCAmJlxuICAgICAgdG9wK2VsUmVjdC5oZWlnaHQrYnVmZmVycy5hbGwrYnVmZmVycy5ib3R0b20gPD0gd2luZG93LmlubmVySGVpZ2h0ICYmXG4gICAgICBsZWZ0K2VsUmVjdC53aWR0aCtidWZmZXJzLmFsbCtidWZmZXJzLnJpZ2h0IDw9IHdpbmRvdy5pbm5lcldpZHRoXG4gICAgKSB7XG4gICAgICBjaG9pY2VBbmRDb29yZCA9IHtjaG9pY2UsIGNvb3JkfTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZhbGxiYWNrIGlmIHdlIGZhaWxlZCB0byBmaW5kIGEgcG9zaXRpb24gdGhhdCBmaXQgb24gdGhlIHNjcmVlbi5cbiAgaWYgKCFjaG9pY2VBbmRDb29yZCkge1xuICAgIGNvbnN0IGNob2ljZSA9IHtcbiAgICAgIHBvc2l0aW9uOiBvcHRpb25Qb3NpdGlvbnNbMF18fCd0b3AnLFxuICAgICAgaEFsaWduOiBvcHRpb25IQWxpZ25zWzBdfHwnY2VudGVyJyxcbiAgICAgIHZBbGlnbjogb3B0aW9uVkFsaWduc1swXXx8J2NlbnRlcidcbiAgICB9O1xuICAgIGNob2ljZUFuZENvb3JkID0ge1xuICAgICAgY2hvaWNlLFxuICAgICAgY29vcmQ6IHBvc2l0aW9uQW5kQWxpZ24oZWxSZWN0LCBhbmNob3JSZWN0LCBjaG9pY2UsIGJ1ZmZlcnMpXG4gICAgfTtcbiAgfVxuXG4gIGVsZW1lbnQuc3R5bGUudG9wID0gYCR7Y2hvaWNlQW5kQ29vcmQuY29vcmQudG9wfXB4YDtcbiAgZWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7Y2hvaWNlQW5kQ29vcmQuY29vcmQubGVmdH1weGA7XG5cbiAgcmV0dXJuIGNob2ljZUFuZENvb3JkLmNob2ljZTtcbn1cblxuZnVuY3Rpb24gZ2V0Qm91bmRpbmdDbGllbnRSZWN0KGVsOiBFbGVtZW50KTogUmVjdCB7XG4gIGxldCByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIGlmICghKCd3aWR0aCcgaW4gcmVjdCkpIHtcbiAgICAvLyBJRSA8OSBzdXBwb3J0XG4gICAgcmVjdCA9IE9iamVjdC5hc3NpZ24oKHtcbiAgICAgIHdpZHRoOiByZWN0LnJpZ2h0LXJlY3QubGVmdCxcbiAgICAgIGhlaWdodDogcmVjdC5ib3R0b20tcmVjdC50b3BcbiAgICB9OiBPYmplY3QpLCByZWN0KTtcbiAgfVxuICByZXR1cm4gcmVjdDtcbn1cblxuZnVuY3Rpb24gcG9zaXRpb25BbmRBbGlnbihlbFJlY3Q6IFJlY3QsIGFuY2hvclJlY3Q6IFJlY3QsIHtwb3NpdGlvbiwgaEFsaWduLCB2QWxpZ259OiBDaG9pY2UsIGJ1ZmZlcnMpOiB7dG9wOiBudW1iZXIsIGxlZnQ6IG51bWJlcn0ge1xuICBsZXQgdG9wPTAsIGxlZnQ9MDtcbiAgaWYgKHBvc2l0aW9uID09PSAnY292ZXInKSB7XG4gICAgc3dpdGNoIChoQWxpZ24pIHtcbiAgICBjYXNlICdjZW50ZXInOlxuICAgICAgbGVmdCA9IE1hdGgucm91bmQoKGFuY2hvclJlY3QubGVmdCArIGFuY2hvclJlY3QucmlnaHQgLSBlbFJlY3Qud2lkdGgpLzIpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbGVmdCc6XG4gICAgICBsZWZ0ID0gTWF0aC5mbG9vcihhbmNob3JSZWN0LmxlZnQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAncmlnaHQnOlxuICAgICAgbGVmdCA9IE1hdGguY2VpbChhbmNob3JSZWN0LnJpZ2h0IC0gZWxSZWN0LndpZHRoKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcignU2hvdWxkIG5vdCBoYXBwZW4nKTtcbiAgICB9XG4gICAgc3dpdGNoICh2QWxpZ24pIHtcbiAgICBjYXNlICdjZW50ZXInOlxuICAgICAgdG9wID0gTWF0aC5yb3VuZCgoYW5jaG9yUmVjdC50b3AgKyBhbmNob3JSZWN0LmJvdHRvbSAtIGVsUmVjdC5oZWlnaHQpLzIpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndG9wJzpcbiAgICAgIHRvcCA9IE1hdGguZmxvb3IoYW5jaG9yUmVjdC50b3ApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYm90dG9tJzpcbiAgICAgIHRvcCA9IE1hdGguY2VpbChhbmNob3JSZWN0LmJvdHRvbSAtIGVsUmVjdC5oZWlnaHQpO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCdTaG91bGQgbm90IGhhcHBlbicpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ3RvcCcgfHwgcG9zaXRpb24gPT09ICdib3R0b20nKSB7XG4gICAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgIGNhc2UgJ3RvcCc6XG4gICAgICB0b3AgPSBNYXRoLmZsb29yKGFuY2hvclJlY3QudG9wIC0gZWxSZWN0LmhlaWdodCAtIGJ1ZmZlcnMuYWxsIC0gYnVmZmVycy5ib3R0b20pO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYm90dG9tJzpcbiAgICAgIHRvcCA9IE1hdGguY2VpbChhbmNob3JSZWN0LmJvdHRvbSArIGJ1ZmZlcnMuYWxsICsgYnVmZmVycy50b3ApO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCdTaG91bGQgbm90IGhhcHBlbicpO1xuICAgIH1cbiAgICBzd2l0Y2ggKGhBbGlnbikge1xuICAgIGNhc2UgJ2NlbnRlcic6XG4gICAgICBsZWZ0ID0gTWF0aC5yb3VuZCgoYW5jaG9yUmVjdC5sZWZ0ICsgYW5jaG9yUmVjdC5yaWdodCAtIGVsUmVjdC53aWR0aCkvMik7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdsZWZ0JzpcbiAgICAgIGxlZnQgPSBNYXRoLnJvdW5kKGFuY2hvclJlY3QubGVmdCk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdyaWdodCc6XG4gICAgICBsZWZ0ID0gTWF0aC5yb3VuZChhbmNob3JSZWN0LnJpZ2h0IC0gZWxSZWN0LndpZHRoKTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcignU2hvdWxkIG5vdCBoYXBwZW4nKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgIGNhc2UgJ2xlZnQnOlxuICAgICAgbGVmdCA9IE1hdGguZmxvb3IoYW5jaG9yUmVjdC5sZWZ0IC0gZWxSZWN0LndpZHRoIC0gYnVmZmVycy5hbGwgLSBidWZmZXJzLnJpZ2h0KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3JpZ2h0JzpcbiAgICAgIGxlZnQgPSBNYXRoLmNlaWwoYW5jaG9yUmVjdC5yaWdodCArIGJ1ZmZlcnMuYWxsICsgYnVmZmVycy5sZWZ0KTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcignU2hvdWxkIG5vdCBoYXBwZW4nKTtcbiAgICB9XG4gICAgc3dpdGNoICh2QWxpZ24pIHtcbiAgICBjYXNlICdjZW50ZXInOlxuICAgICAgdG9wID0gTWF0aC5yb3VuZCgoYW5jaG9yUmVjdC50b3AgKyBhbmNob3JSZWN0LmJvdHRvbSAtIGVsUmVjdC5oZWlnaHQpLzIpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndG9wJzpcbiAgICAgIHRvcCA9IE1hdGgucm91bmQoYW5jaG9yUmVjdC50b3ApO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnYm90dG9tJzpcbiAgICAgIHRvcCA9IE1hdGgucm91bmQoYW5jaG9yUmVjdC5ib3R0b20gLSBlbFJlY3QuaGVpZ2h0KTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcignU2hvdWxkIG5vdCBoYXBwZW4nKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHt0b3AsIGxlZnR9O1xufVxuIl19